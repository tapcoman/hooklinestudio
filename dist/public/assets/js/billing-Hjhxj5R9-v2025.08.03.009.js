import{r as o,Q as _,j as e,E as le,F as ce,w as de,u as R,W as pe,c as ue,x as me,f as xe,n as ge,T as he,z as fe,y as T,O as je}from"./ui-vendor-BAeonq7J-v2025.08.03.009.js";import{u as v}from"./useQuery-qFlBtTco-v2025.08.03.009.js";import{s as m,z as k,b as ve,a as Ne,c as S,t as ye,C as N,v as y,w as b,x as A,e as P,d as w,A as E,B as x}from"./index-DE-Ruv-d-v2025.08.03.009.js";import{S as be}from"./separator-lLiMj8FB-v2025.08.03.009.js";import{o as Ae,a4 as we,p as De,x as Ce,a5 as Se}from"./utils-vendor-CpPq9sEF-v2025.08.03.009.js";var O="AlertDialog",[Pe,Ve]=ue(O,[_]),p=_(),$=a=>{const{__scopeAlertDialog:s,...t}=a,n=p(s);return e.jsx(le,{...n,...t,modal:!0})};$.displayName=O;var Ee="AlertDialogTrigger",F=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,r=p(t);return e.jsx(ce,{...r,...n,ref:s})});F.displayName=Ee;var _e="AlertDialogPortal",I=a=>{const{__scopeAlertDialog:s,...t}=a,n=p(s);return e.jsx(de,{...n,...t})};I.displayName=_e;var Re="AlertDialogOverlay",M=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,r=p(t);return e.jsx(je,{...r,...n,ref:s})});M.displayName=Re;var g="AlertDialogContent",[Te,ke]=Pe(g),Oe=ge("AlertDialogContent"),B=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,children:n,...r}=a,c=p(t),h=o.useRef(null),f=R(s,h),u=o.useRef(null);return e.jsx(pe,{contentName:g,titleName:z,docsSlug:"alert-dialog",children:e.jsx(Te,{scope:t,cancelRef:u,children:e.jsxs(me,{role:"alertdialog",...c,...r,ref:f,onOpenAutoFocus:xe(r.onOpenAutoFocus,d=>{d.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(Oe,{children:n}),e.jsx(Fe,{contentRef:h})]})})})});B.displayName=g;var z="AlertDialogTitle",L=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,r=p(t);return e.jsx(he,{...r,...n,ref:s})});L.displayName=z;var U="AlertDialogDescription",q=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,r=p(t);return e.jsx(fe,{...r,...n,ref:s})});q.displayName=U;var $e="AlertDialogAction",H=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,r=p(t);return e.jsx(T,{...r,...n,ref:s})});H.displayName=$e;var K="AlertDialogCancel",Y=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,{cancelRef:r}=ke(K,t),c=p(t),h=R(s,r);return e.jsx(T,{...c,...n,ref:h})});Y.displayName=K;var Fe=({contentRef:a})=>{const s=`\`${g}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${g}\` by passing a \`${U}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${g}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{document.getElementById(a.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},Ie=$,Me=F,Be=I,G=M,V=B,Q=H,W=Y,J=L,X=q;const ze=Ie,Le=Me,Ue=Be,Z=o.forwardRef(({className:a,...s},t)=>e.jsx(G,{className:m("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));Z.displayName=G.displayName;const ee=o.forwardRef(({className:a,...s},t)=>e.jsxs(Ue,{children:[e.jsx(Z,{}),e.jsx(V,{ref:t,className:m("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));ee.displayName=V.displayName;const se=({className:a,...s})=>e.jsx("div",{className:m("flex flex-col space-y-2 text-center sm:text-left",a),...s});se.displayName="AlertDialogHeader";const ae=({className:a,...s})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});ae.displayName="AlertDialogFooter";const te=o.forwardRef(({className:a,...s},t)=>e.jsx(J,{ref:t,className:m("text-lg font-semibold",a),...s}));te.displayName=J.displayName;const re=o.forwardRef(({className:a,...s},t)=>e.jsx(X,{ref:t,className:m("text-sm text-muted-foreground",a),...s}));re.displayName=X.displayName;const ie=o.forwardRef(({className:a,...s},t)=>e.jsx(Q,{ref:t,className:m(k(),a),...s}));ie.displayName=Q.displayName;const ne=o.forwardRef(({className:a,...s},t)=>e.jsx(W,{ref:t,className:m(k({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));ne.displayName=W.displayName;function Qe(){const{backendUser:a}=ve(),{toast:s}=Ne(),[t,n]=o.useState(!1),{data:r}=v({queryKey:["/api/users/me"],queryFn:async()=>{const i=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to fetch user");return i.json()},enabled:!!a}),{data:c,isLoading:h}=v({queryKey:["/api/stripe/subscription"],queryFn:async()=>{const i=await fetch("/api/stripe/subscription",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});return i.ok?i.json():null},enabled:!!r?.stripeSubscriptionId}),{data:f}=v({queryKey:["/api/stripe/plans"],queryFn:async()=>{const i=await fetch("/api/stripe/plans",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to fetch plans");return i.json()}}),u=S({mutationFn:async()=>{const i=await fetch("/api/stripe/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("firebase_token")}`},body:JSON.stringify({returnUrl:window.location.origin+"/billing"})});if(!i.ok)throw new Error("Failed to create portal session");return i.json()},onSuccess:i=>{window.open(i.url,"_blank")},onError:i=>{s({title:"Failed to open billing portal",description:i.message,variant:"destructive"})}}),d=S({mutationFn:async()=>{const i=await fetch("/api/stripe/cancel",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to cancel subscription");return i.json()},onSuccess:()=>{s({title:"Subscription canceled",description:"Your subscription will end at the current billing period."}),ye.invalidateQueries({queryKey:["/api/stripe/subscription"]})},onError:i=>{s({title:"Failed to cancel subscription",description:i.message,variant:"destructive"})}}),j=()=>{n(!0),u.mutate()},oe=()=>{d.mutate()},D=i=>new Date(i*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading billing information..."})]})});const l=r?.subscriptionPlan||"free",C=f?.plans?.[l.toUpperCase()];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Billing & Subscription"}),e.jsx("p",{className:"text-slate-600",children:"Manage your subscription, billing information, and payment methods."})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(N,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xl",children:"Current Plan"}),e.jsx(A,{children:"Your active subscription"})]})]}),e.jsx(P,{variant:l==="free"?"secondary":"default",className:"text-sm",children:l.charAt(0).toUpperCase()+l.slice(1)})]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900",children:[C?.name||l.charAt(0).toUpperCase()+l.slice(1)," Plan"]}),e.jsx("p",{className:"text-slate-600",children:l==="free"?"Free forever":`$${C?.amount||0}/month`})]}),l!=="free"&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Status"}),e.jsx(P,{variant:r?.subscriptionStatus==="active"?"default":r?.subscriptionStatus==="trialing"?"secondary":"destructive",children:r?.subscriptionStatus||"Unknown"})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.currentPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Next billing date"}),e.jsx("p",{className:"font-medium",children:D(c.currentPeriodEnd)})]})]}),c.cancelAtPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600",children:"Cancels on"}),e.jsx("p",{className:"font-medium text-orange-700",children:D(c.currentPeriodEnd)})]})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:l==="free"?e.jsx(E,{href:"/pricing",children:e.jsx(x,{className:"w-full sm:w-auto",children:"Upgrade Plan"})}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:j,disabled:t||u.isPending,className:"w-full sm:w-auto",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),u.isPending?"Opening...":"Manage Billing"]}),e.jsx(E,{href:"/pricing",children:e.jsx(x,{variant:"outline",className:"w-full sm:w-auto",children:"Change Plan"})}),!c?.cancelAtPeriodEnd&&e.jsxs(ze,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"w-full sm:w-auto text-red-600 hover:text-red-700",children:"Cancel Subscription"})}),e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(te,{children:"Cancel Subscription"}),e.jsx(re,{children:"Are you sure you want to cancel your subscription? You'll continue to have access until the end of your current billing period."})]}),e.jsxs(ae,{children:[e.jsx(ne,{children:"Keep Subscription"}),e.jsx(ie,{onClick:oe,disabled:d.isPending,className:"bg-red-600 hover:bg-red-700",children:d.isPending?"Canceling...":"Cancel Subscription"})]})]})]})]})})]})]}),e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(b,{className:"text-xl",children:"Usage This Month"}),e.jsx(A,{children:"Track your hook generation usage"})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Hook Generations"}),e.jsxs("span",{className:"font-medium",children:[r?.usedCredits||0," / ",l==="free"?r?.freeCredits||5:"∞"]})]}),l==="free"&&e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,parseInt(r?.usedCredits||"0")/parseInt(r?.freeCredits||"5")*100)}%`}})}),e.jsx("p",{className:"text-sm text-slate-600",children:l==="free"?`${parseInt(r?.freeCredits||"5")-parseInt(r?.usedCredits||"0")} hooks remaining this month`:"Unlimited hook generation included in your plan"})]})})]}),e.jsxs(N,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-xl",children:"Billing History"}),e.jsx(A,{children:"View and download your invoices"})]}),l!=="free"&&e.jsxs(x,{variant:"outline",size:"sm",onClick:j,disabled:u.isPending,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"View All Invoices"]})]})}),e.jsx(w,{children:l==="free"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"No billing history available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upgrade to a paid plan to view billing history and invoices."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"Access your complete billing history"}),e.jsx(x,{onClick:j,disabled:u.isPending,variant:"outline",children:"Open Billing Portal"})]})})]})]})]})})}export{Qe as default};
