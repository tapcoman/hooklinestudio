import{a$ as H,b0 as K,r as c,j as e,b1 as V,b2 as k,b3 as P,b4 as D,b5 as F,b6 as E,b7 as B,aR as f,e as C,aq as Y,b8 as Q,ar as G,q as A,aE as J,b9 as W}from"./react-vendor-BiQIbcdL-v2025.08.03.012.js";import{n as o,t as I,a as X,u as Z,q as ee,C as g,o as j,p as b,r as N,c as S,b as y,B as m}from"./index-BydpgK2q-v2025.08.03.012.js";import{S as se}from"./separator-BNOFNUFA-v2025.08.03.012.js";import"./vendor-9fi0qQp5-v2025.08.03.012.js";import"./utils-vendor-BTGVH9Kg-v2025.08.03.012.js";import"./ui-vendor-CLsjAtpL-v2025.08.03.012.js";const ae=H,te=K,ie=V,T=c.forwardRef(({className:i,...t},r)=>e.jsx(B,{className:o("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...t,ref:r}));T.displayName=B.displayName;const q=c.forwardRef(({className:i,...t},r)=>e.jsxs(ie,{children:[e.jsx(T,{}),e.jsx(k,{ref:r,className:o("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...t})]}));q.displayName=k.displayName;const U=({className:i,...t})=>e.jsx("div",{className:o("flex flex-col space-y-2 text-center sm:text-left",i),...t});U.displayName="AlertDialogHeader";const z=({className:i,...t})=>e.jsx("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",i),...t});z.displayName="AlertDialogFooter";const $=c.forwardRef(({className:i,...t},r)=>e.jsx(P,{ref:r,className:o("text-lg font-semibold",i),...t}));$.displayName=P.displayName;const R=c.forwardRef(({className:i,...t},r)=>e.jsx(D,{ref:r,className:o("text-sm text-muted-foreground",i),...t}));R.displayName=D.displayName;const L=c.forwardRef(({className:i,...t},r)=>e.jsx(E,{ref:r,className:o(I(),i),...t}));L.displayName=E.displayName;const M=c.forwardRef(({className:i,...t},r)=>e.jsx(F,{ref:r,className:o(I({variant:"outline"}),"mt-2 sm:mt-0",i),...t}));M.displayName=F.displayName;function xe(){var v;const{backendUser:i}=X(),{toast:t}=Z(),[r,O]=c.useState(!1),{data:s}=f({queryKey:["/api/users/me"],queryFn:async()=>{const a=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!a.ok)throw new Error("Failed to fetch user");return a.json()},enabled:!!i}),{data:l,isLoading:ne}=f({queryKey:["/api/stripe/subscription"],queryFn:async()=>{const a=await fetch("/api/stripe/subscription",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});return a.ok?a.json():null},enabled:!!(s!=null&&s.stripeSubscriptionId)}),{data:p}=f({queryKey:["/api/stripe/plans"],queryFn:async()=>{const a=await fetch("/api/stripe/plans",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!a.ok)throw new Error("Failed to fetch plans");return a.json()}}),x=C({mutationFn:async()=>{const a=await fetch("/api/stripe/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("firebase_token")}`},body:JSON.stringify({returnUrl:window.location.origin+"/billing"})});if(!a.ok)throw new Error("Failed to create portal session");return a.json()},onSuccess:a=>{window.open(a.url,"_blank")},onError:a=>{t({title:"Failed to open billing portal",description:a.message,variant:"destructive"})}}),h=C({mutationFn:async()=>{const a=await fetch("/api/stripe/cancel",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!a.ok)throw new Error("Failed to cancel subscription");return a.json()},onSuccess:()=>{t({title:"Subscription canceled",description:"Your subscription will end at the current billing period."}),ee.invalidateQueries({queryKey:["/api/stripe/subscription"]})},onError:a=>{t({title:"Failed to cancel subscription",description:a.message,variant:"destructive"})}}),u=()=>{O(!0),x.mutate()},_=()=>{h.mutate()},w=a=>new Date(a*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});if(!s)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading billing information..."})]})});const n=(s==null?void 0:s.subscriptionPlan)||"free",d=(v=p==null?void 0:p.plans)==null?void 0:v[n.toUpperCase()];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Billing & Subscription"}),e.jsx("p",{className:"text-slate-600",children:"Manage your subscription, billing information, and payment methods."})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xl",children:"Current Plan"}),e.jsx(N,{children:"Your active subscription"})]})]}),e.jsx(S,{variant:n==="free"?"secondary":"default",className:"text-sm",children:n.charAt(0).toUpperCase()+n.slice(1)})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900",children:[(d==null?void 0:d.name)||n.charAt(0).toUpperCase()+n.slice(1)," Plan"]}),e.jsx("p",{className:"text-slate-600",children:n==="free"?"Free forever":`$${(d==null?void 0:d.amount)||0}/month`})]}),n!=="free"&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Status"}),e.jsx(S,{variant:(s==null?void 0:s.subscriptionStatus)==="active"?"default":(s==null?void 0:s.subscriptionStatus)==="trialing"?"secondary":"destructive",children:(s==null?void 0:s.subscriptionStatus)||"Unknown"})]})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.currentPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Next billing date"}),e.jsx("p",{className:"font-medium",children:w(l.currentPeriodEnd)})]})]}),l.cancelAtPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600",children:"Cancels on"}),e.jsx("p",{className:"font-medium text-orange-700",children:w(l.currentPeriodEnd)})]})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:n==="free"?e.jsx(A,{href:"/pricing",children:e.jsx(m,{className:"w-full sm:w-auto",children:"Upgrade Plan"})}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{onClick:u,disabled:r||x.isPending,className:"w-full sm:w-auto",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),x.isPending?"Opening...":"Manage Billing"]}),e.jsx(A,{href:"/pricing",children:e.jsx(m,{variant:"outline",className:"w-full sm:w-auto",children:"Change Plan"})}),!(l!=null&&l.cancelAtPeriodEnd)&&e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx(m,{variant:"outline",className:"w-full sm:w-auto text-red-600 hover:text-red-700",children:"Cancel Subscription"})}),e.jsxs(q,{children:[e.jsxs(U,{children:[e.jsx($,{children:"Cancel Subscription"}),e.jsx(R,{children:"Are you sure you want to cancel your subscription? You'll continue to have access until the end of your current billing period."})]}),e.jsxs(z,{children:[e.jsx(M,{children:"Keep Subscription"}),e.jsx(L,{onClick:_,disabled:h.isPending,className:"bg-red-600 hover:bg-red-700",children:h.isPending?"Canceling...":"Cancel Subscription"})]})]})]})]})})]})]}),e.jsxs(g,{children:[e.jsxs(j,{children:[e.jsx(b,{className:"text-xl",children:"Usage This Month"}),e.jsx(N,{children:"Track your hook generation usage"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Hook Generations"}),e.jsxs("span",{className:"font-medium",children:[(s==null?void 0:s.usedCredits)||0," / ",n==="free"?(s==null?void 0:s.freeCredits)||5:"âˆž"]})]}),n==="free"&&e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,parseInt((s==null?void 0:s.usedCredits)||"0")/parseInt((s==null?void 0:s.freeCredits)||"5")*100)}%`}})}),e.jsx("p",{className:"text-sm text-slate-600",children:n==="free"?`${parseInt((s==null?void 0:s.freeCredits)||"5")-parseInt((s==null?void 0:s.usedCredits)||"0")} hooks remaining this month`:"Unlimited hook generation included in your plan"})]})})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-xl",children:"Billing History"}),e.jsx(N,{children:"View and download your invoices"})]}),n!=="free"&&e.jsxs(m,{variant:"outline",size:"sm",onClick:u,disabled:x.isPending,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"View All Invoices"]})]})}),e.jsx(y,{children:n==="free"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"No billing history available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upgrade to a paid plan to view billing history and invoices."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"Access your complete billing history"}),e.jsx(m,{onClick:u,disabled:x.isPending,variant:"outline",children:"Open Billing Portal"})]})})]})]})]})})}export{xe as default};
