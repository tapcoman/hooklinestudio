import{h as le,r as o,a1 as _,j as e,Q as ce,T as de,U as pe,a2 as k,a3 as ue,a4 as me,V as xe,a5 as ge,a6 as he,Y as fe,$ as je,W as R,a0 as ve,x as m,a7 as T,b as Ne,a as ye,c as S,z as be,C as v,G as N,N as Ae,H as y,K as b,e as P,d as A,a8 as we,a9 as E,B as x}from"./index-BgezxcFr.js";import{u as w}from"./useQuery-BDhHusTH.js";import{S as De,C as Ce}from"./separator-DyRlcsb8.js";import{C as Se}from"./calendar-Cb0AWD16.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=le("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var $="AlertDialog",[Ee,Ge]=me($,[_]),p=_(),I=s=>{const{__scopeAlertDialog:a,...t}=s,n=p(a);return e.jsx(ce,{...n,...t,modal:!0})};I.displayName=$;var _e="AlertDialogTrigger",M=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,r=p(t);return e.jsx(de,{...r,...n,ref:a})});M.displayName=_e;var ke="AlertDialogPortal",O=s=>{const{__scopeAlertDialog:a,...t}=s,n=p(a);return e.jsx(pe,{...n,...t})};O.displayName=ke;var Re="AlertDialogOverlay",F=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,r=p(t);return e.jsx(ve,{...r,...n,ref:a})});F.displayName=Re;var g="AlertDialogContent",[Te,$e]=Ee(g),Ie=he("AlertDialogContent"),B=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,children:n,...r}=s,c=p(t),h=o.useRef(null),f=k(a,h),u=o.useRef(null);return e.jsx(ue,{contentName:g,titleName:L,docsSlug:"alert-dialog",children:e.jsx(Te,{scope:t,cancelRef:u,children:e.jsxs(xe,{role:"alertdialog",...c,...r,ref:f,onOpenAutoFocus:ge(r.onOpenAutoFocus,d=>{d.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(Ie,{children:n}),e.jsx(Oe,{contentRef:h})]})})})});B.displayName=g;var L="AlertDialogTitle",q=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,r=p(t);return e.jsx(fe,{...r,...n,ref:a})});q.displayName=L;var U="AlertDialogDescription",z=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,r=p(t);return e.jsx(je,{...r,...n,ref:a})});z.displayName=U;var Me="AlertDialogAction",H=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,r=p(t);return e.jsx(R,{...r,...n,ref:a})});H.displayName=Me;var K="AlertDialogCancel",V=o.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...n}=s,{cancelRef:r}=$e(K,t),c=p(t),h=k(a,r);return e.jsx(R,{...c,...n,ref:h})});V.displayName=K;var Oe=({contentRef:s})=>{const a=`\`${g}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${g}\` by passing a \`${U}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${g}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},Fe=I,Be=M,Le=O,Y=F,G=B,Q=H,W=V,J=q,X=z;const qe=Fe,Ue=Be,ze=Le,Z=o.forwardRef(({className:s,...a},t)=>e.jsx(Y,{className:m("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));Z.displayName=Y.displayName;const ee=o.forwardRef(({className:s,...a},t)=>e.jsxs(ze,{children:[e.jsx(Z,{}),e.jsx(G,{ref:t,className:m("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));ee.displayName=G.displayName;const ae=({className:s,...a})=>e.jsx("div",{className:m("flex flex-col space-y-2 text-center sm:text-left",s),...a});ae.displayName="AlertDialogHeader";const se=({className:s,...a})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});se.displayName="AlertDialogFooter";const te=o.forwardRef(({className:s,...a},t)=>e.jsx(J,{ref:t,className:m("text-lg font-semibold",s),...a}));te.displayName=J.displayName;const re=o.forwardRef(({className:s,...a},t)=>e.jsx(X,{ref:t,className:m("text-sm text-muted-foreground",s),...a}));re.displayName=X.displayName;const ie=o.forwardRef(({className:s,...a},t)=>e.jsx(Q,{ref:t,className:m(T(),s),...a}));ie.displayName=Q.displayName;const ne=o.forwardRef(({className:s,...a},t)=>e.jsx(W,{ref:t,className:m(T({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));ne.displayName=W.displayName;function Qe(){const{backendUser:s}=Ne(),{toast:a}=ye(),[t,n]=o.useState(!1),{data:r}=w({queryKey:["/api/users/me"],queryFn:async()=>{const i=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to fetch user");return i.json()},enabled:!!s}),{data:c,isLoading:h}=w({queryKey:["/api/stripe/subscription"],queryFn:async()=>{const i=await fetch("/api/stripe/subscription",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});return i.ok?i.json():null},enabled:!!r?.stripeSubscriptionId}),{data:f}=w({queryKey:["/api/stripe/plans"],queryFn:async()=>{const i=await fetch("/api/stripe/plans",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to fetch plans");return i.json()}}),u=S({mutationFn:async()=>{const i=await fetch("/api/stripe/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("firebase_token")}`},body:JSON.stringify({returnUrl:window.location.origin+"/billing"})});if(!i.ok)throw new Error("Failed to create portal session");return i.json()},onSuccess:i=>{window.open(i.url,"_blank")},onError:i=>{a({title:"Failed to open billing portal",description:i.message,variant:"destructive"})}}),d=S({mutationFn:async()=>{const i=await fetch("/api/stripe/cancel",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!i.ok)throw new Error("Failed to cancel subscription");return i.json()},onSuccess:()=>{a({title:"Subscription canceled",description:"Your subscription will end at the current billing period."}),be.invalidateQueries({queryKey:["/api/stripe/subscription"]})},onError:i=>{a({title:"Failed to cancel subscription",description:i.message,variant:"destructive"})}}),j=()=>{n(!0),u.mutate()},oe=()=>{d.mutate()},D=i=>new Date(i*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading billing information..."})]})});const l=r?.subscriptionPlan||"free",C=f?.plans?.[l.toUpperCase()];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Billing & Subscription"}),e.jsx("p",{className:"text-slate-600",children:"Manage your subscription, billing information, and payment methods."})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xl",children:"Current Plan"}),e.jsx(b,{children:"Your active subscription"})]})]}),e.jsx(P,{variant:l==="free"?"secondary":"default",className:"text-sm",children:l.charAt(0).toUpperCase()+l.slice(1)})]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900",children:[C?.name||l.charAt(0).toUpperCase()+l.slice(1)," Plan"]}),e.jsx("p",{className:"text-slate-600",children:l==="free"?"Free forever":`$${C?.amount||0}/month`})]}),l!=="free"&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Status"}),e.jsx(P,{variant:r?.subscriptionStatus==="active"?"default":r?.subscriptionStatus==="trialing"?"secondary":"destructive",children:r?.subscriptionStatus||"Unknown"})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(De,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.currentPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Next billing date"}),e.jsx("p",{className:"font-medium",children:D(c.currentPeriodEnd)})]})]}),c.cancelAtPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600",children:"Cancels on"}),e.jsx("p",{className:"font-medium text-orange-700",children:D(c.currentPeriodEnd)})]})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:l==="free"?e.jsx(E,{href:"/pricing",children:e.jsx(x,{className:"w-full sm:w-auto",children:"Upgrade Plan"})}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:j,disabled:t||u.isPending,className:"w-full sm:w-auto",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),u.isPending?"Opening...":"Manage Billing"]}),e.jsx(E,{href:"/pricing",children:e.jsx(x,{variant:"outline",className:"w-full sm:w-auto",children:"Change Plan"})}),!c?.cancelAtPeriodEnd&&e.jsxs(qe,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"w-full sm:w-auto text-red-600 hover:text-red-700",children:"Cancel Subscription"})}),e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Cancel Subscription"}),e.jsx(re,{children:"Are you sure you want to cancel your subscription? You'll continue to have access until the end of your current billing period."})]}),e.jsxs(se,{children:[e.jsx(ne,{children:"Keep Subscription"}),e.jsx(ie,{onClick:oe,disabled:d.isPending,className:"bg-red-600 hover:bg-red-700",children:d.isPending?"Canceling...":"Cancel Subscription"})]})]})]})]})})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{className:"text-xl",children:"Usage This Month"}),e.jsx(b,{children:"Track your hook generation usage"})]}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Hook Generations"}),e.jsxs("span",{className:"font-medium",children:[r?.usedCredits||0," / ",l==="free"?r?.freeCredits||5:"∞"]})]}),l==="free"&&e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,parseInt(r?.usedCredits||"0")/parseInt(r?.freeCredits||"5")*100)}%`}})}),e.jsx("p",{className:"text-sm text-slate-600",children:l==="free"?`${parseInt(r?.freeCredits||"5")-parseInt(r?.usedCredits||"0")} hooks remaining this month`:"Unlimited hook generation included in your plan"})]})})]}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-xl",children:"Billing History"}),e.jsx(b,{children:"View and download your invoices"})]}),l!=="free"&&e.jsxs(x,{variant:"outline",size:"sm",onClick:j,disabled:u.isPending,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"View All Invoices"]})]})}),e.jsx(A,{children:l==="free"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"No billing history available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upgrade to a paid plan to view billing history and invoices."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"Access your complete billing history"}),e.jsx(x,{onClick:j,disabled:u.isPending,variant:"outline",children:"Open Billing Portal"})]})})]})]})]})})}export{Qe as default};
