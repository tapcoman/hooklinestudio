import{aY as _,aZ as H,r as o,j as e,a_ as K,a$ as A,b0 as S,b1 as k,b2 as P,b3 as D,b4 as F,aO as u,f as w,ap as Y,b5 as V,aq as Q,aB as G,b6 as J}from"./react-vendor-CTpIrEzv-v2025.08.03.010.js";import{n as l,t as B,a as Z,u as W,q as X,C as h,o as f,p as g,r as j,c as v,b,B as d}from"./index-BIRwcLTk-v2025.08.03.010.js";import{S as ee}from"./separator-BACKhKa6-v2025.08.03.010.js";import{Y as C}from"./vendor-DOYiqK_t-v2025.08.03.010.js";import"./utils-vendor-BkLtITBR-v2025.08.03.010.js";import"./ui-vendor-DJYb332p-v2025.08.03.010.js";const se=_,ae=H,te=K,E=o.forwardRef(({className:t,...a},r)=>e.jsx(F,{className:l("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a,ref:r}));E.displayName=F.displayName;const I=o.forwardRef(({className:t,...a},r)=>e.jsxs(te,{children:[e.jsx(E,{}),e.jsx(A,{ref:r,className:l("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a})]}));I.displayName=A.displayName;const T=({className:t,...a})=>e.jsx("div",{className:l("flex flex-col space-y-2 text-center sm:text-left",t),...a});T.displayName="AlertDialogHeader";const U=({className:t,...a})=>e.jsx("div",{className:l("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a});U.displayName="AlertDialogFooter";const q=o.forwardRef(({className:t,...a},r)=>e.jsx(S,{ref:r,className:l("text-lg font-semibold",t),...a}));q.displayName=S.displayName;const z=o.forwardRef(({className:t,...a},r)=>e.jsx(k,{ref:r,className:l("text-sm text-muted-foreground",t),...a}));z.displayName=k.displayName;const $=o.forwardRef(({className:t,...a},r)=>e.jsx(D,{ref:r,className:l(B(),t),...a}));$.displayName=D.displayName;const L=o.forwardRef(({className:t,...a},r)=>e.jsx(P,{ref:r,className:l(B({variant:"outline"}),"mt-2 sm:mt-0",t),...a}));L.displayName=P.displayName;function me(){const{backendUser:t}=Z(),{toast:a}=W(),[r,M]=o.useState(!1),{data:n}=u({queryKey:["/api/users/me"],queryFn:async()=>{const s=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!s.ok)throw new Error("Failed to fetch user");return s.json()},enabled:!!t}),{data:c,isLoading:ie}=u({queryKey:["/api/stripe/subscription"],queryFn:async()=>{const s=await fetch("/api/stripe/subscription",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});return s.ok?s.json():null},enabled:!!n?.stripeSubscriptionId}),{data:O}=u({queryKey:["/api/stripe/plans"],queryFn:async()=>{const s=await fetch("/api/stripe/plans",{headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!s.ok)throw new Error("Failed to fetch plans");return s.json()}}),m=w({mutationFn:async()=>{const s=await fetch("/api/stripe/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("firebase_token")}`},body:JSON.stringify({returnUrl:window.location.origin+"/billing"})});if(!s.ok)throw new Error("Failed to create portal session");return s.json()},onSuccess:s=>{window.open(s.url,"_blank")},onError:s=>{a({title:"Failed to open billing portal",description:s.message,variant:"destructive"})}}),x=w({mutationFn:async()=>{const s=await fetch("/api/stripe/cancel",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("firebase_token")}`}});if(!s.ok)throw new Error("Failed to cancel subscription");return s.json()},onSuccess:()=>{a({title:"Subscription canceled",description:"Your subscription will end at the current billing period."}),X.invalidateQueries({queryKey:["/api/stripe/subscription"]})},onError:s=>{a({title:"Failed to cancel subscription",description:s.message,variant:"destructive"})}}),p=()=>{M(!0),m.mutate()},R=()=>{x.mutate()},N=s=>new Date(s*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});if(!n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading billing information..."})]})});const i=n?.subscriptionPlan||"free",y=O?.plans?.[i.toUpperCase()];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Billing & Subscription"}),e.jsx("p",{className:"text-slate-600",children:"Manage your subscription, billing information, and payment methods."})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xl",children:"Current Plan"}),e.jsx(j,{children:"Your active subscription"})]})]}),e.jsx(v,{variant:i==="free"?"secondary":"default",className:"text-sm",children:i.charAt(0).toUpperCase()+i.slice(1)})]})}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900",children:[y?.name||i.charAt(0).toUpperCase()+i.slice(1)," Plan"]}),e.jsx("p",{className:"text-slate-600",children:i==="free"?"Free forever":`$${y?.amount||0}/month`})]}),i!=="free"&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Status"}),e.jsx(v,{variant:n?.subscriptionStatus==="active"?"default":n?.subscriptionStatus==="trialing"?"secondary":"destructive",children:n?.subscriptionStatus||"Unknown"})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(ee,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.currentPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Next billing date"}),e.jsx("p",{className:"font-medium",children:N(c.currentPeriodEnd)})]})]}),c.cancelAtPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600",children:"Cancels on"}),e.jsx("p",{className:"font-medium text-orange-700",children:N(c.currentPeriodEnd)})]})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:i==="free"?e.jsx(C,{href:"/pricing",children:e.jsx(d,{className:"w-full sm:w-auto",children:"Upgrade Plan"})}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:p,disabled:r||m.isPending,className:"w-full sm:w-auto",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),m.isPending?"Opening...":"Manage Billing"]}),e.jsx(C,{href:"/pricing",children:e.jsx(d,{variant:"outline",className:"w-full sm:w-auto",children:"Change Plan"})}),!c?.cancelAtPeriodEnd&&e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(d,{variant:"outline",className:"w-full sm:w-auto text-red-600 hover:text-red-700",children:"Cancel Subscription"})}),e.jsxs(I,{children:[e.jsxs(T,{children:[e.jsx(q,{children:"Cancel Subscription"}),e.jsx(z,{children:"Are you sure you want to cancel your subscription? You'll continue to have access until the end of your current billing period."})]}),e.jsxs(U,{children:[e.jsx(L,{children:"Keep Subscription"}),e.jsx($,{onClick:R,disabled:x.isPending,className:"bg-red-600 hover:bg-red-700",children:x.isPending?"Canceling...":"Cancel Subscription"})]})]})]})]})})]})]}),e.jsxs(h,{children:[e.jsxs(f,{children:[e.jsx(g,{className:"text-xl",children:"Usage This Month"}),e.jsx(j,{children:"Track your hook generation usage"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Hook Generations"}),e.jsxs("span",{className:"font-medium",children:[n?.usedCredits||0," / ",i==="free"?n?.freeCredits||5:"âˆž"]})]}),i==="free"&&e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,parseInt(n?.usedCredits||"0")/parseInt(n?.freeCredits||"5")*100)}%`}})}),e.jsx("p",{className:"text-sm text-slate-600",children:i==="free"?`${parseInt(n?.freeCredits||"5")-parseInt(n?.usedCredits||"0")} hooks remaining this month`:"Unlimited hook generation included in your plan"})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-xl",children:"Billing History"}),e.jsx(j,{children:"View and download your invoices"})]}),i!=="free"&&e.jsxs(d,{variant:"outline",size:"sm",onClick:p,disabled:m.isPending,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"View All Invoices"]})]})}),e.jsx(b,{children:i==="free"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"No billing history available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upgrade to a paid plan to view billing history and invoices."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"Access your complete billing history"}),e.jsx(d,{onClick:p,disabled:m.isPending,variant:"outline",children:"Open Billing Portal"})]})})]})]})]})})}export{me as default};
